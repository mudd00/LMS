# 🚀 MetaPlaza 개발 환경 설정 가이드

## 서버 구동 방법

### 1️⃣ 프론트엔드 서버 실행
```bash
# 프로젝트 루트 디렉토리에서
npm start
```
- 실행 후 브라우저에서 `http://localhost:3000` 자동 오픈
- React 개발 서버가 3000번 포트에서 실행됩니다

### 2️⃣ 백엔드 서버 실행

#### 방법 1: IntelliJ IDEA에서 실행 (권장)
1. **Gradle 프로젝트 열기**
   - IntelliJ에서 `File` → `Open`
   - `backend/build.gradle` 파일 선택
   - "Open as Project" 클릭

2. **Gradle Sync 대기**
   - IntelliJ가 자동으로 의존성 다운로드 & 빌드 시작
   - 우측 하단 또는 "Gradle" 탭에서 진행 상황 확인
   - 완료될 때까지 대기 (처음엔 수 분 소요 가능)

3. **애플리케이션 실행**
   - `src/main/java/com/community/CommunityApplication.java` 파일 열기
   - 파일 우클릭 → `Run 'CommunityApplication'`
   - 또는 `main` 메서드 옆 초록색 ▶️ 버튼 클릭

#### 방법 2: 터미널에서 실행
```bash
# backend 디렉토리로 이동
cd backend

# Gradle로 Spring Boot 실행
./gradlew bootRun

# 수동 빌드가 필요한 경우
./gradlew clean build
```

#### 실행 확인
- Spring Boot 서버가 8080번 포트에서 실행됩니다
- API 엔드포인트: `http://localhost:8080`
- 콘솔에 "Started CommunityApplication" 메시지 확인

---

## 🔀 Git 충돌 대비 방안

### 왜 컴포넌트를 분리했나요?
기존에는 `App.js` 파일에 636줄의 코드가 몰려있었습니다. 여러 명이 동시에 작업하면서 `git pull`, `git merge` 시 충돌이 자주 발생했습니다.

### 분리된 컴포넌트 구조 (현재)

```
src/
├── App.js                          # 메인 앱 (287줄)
├── components/
│   ├── character/
│   │   └── Character.jsx          # 캐릭터 모델 & 물리 & 애니메이션
│   ├── camera/
│   │   ├── CameraController.jsx   # 카메라 추적 로직
│   │   └── CameraLogger.jsx       # 디버그 로거
│   ├── map/
│   │   ├── Level1.jsx             # 레벨 1 전체 씬
│   │   ├── Level1Map.jsx          # 맵 모델 로드
│   │   └── Sky.jsx                # 하늘 배경
│   ├── AuthModal.js               # 로그인/회원가입
│   ├── BoardModal.js              # 게시판 메인
│   ├── MenuModal.js               # ESC 메뉴
│   └── ...
└── useKeyboardControls.js         # 키보드 입력 훅
```

### 향후 구조 (요구사항 기반)

요구사항 명세서에 따라 다음 구조로 리팩토링 예정:

```
src/
├── pages/                          # 페이지 라우팅
│   ├── GamePage.jsx               # 메인 게임
│   ├── AdminPage.jsx              # 관리자 페이지
│   └── LandingPage.jsx            # 로그인
│
├── features/                       # 기능별 모듈 (중요!)
│   ├── auth/                      # 회원 시스템
│   ├── profile/                   # 프로필
│   ├── world/                     # 3D 공간
│   │   ├── character/
│   │   ├── camera/
│   │   ├── maps/
│   │   └── physics/
│   ├── localRoom/                 # 로컬 방 (GPS 기반)
│   ├── map/                       # 지도 연동
│   ├── social/                    # 소셜 기능
│   │   ├── chat/
│   │   ├── friends/
│   │   ├── block/
│   │   └── userList/
│   ├── minigame/                  # 미니게임
│   ├── customization/             # 커스터마이징
│   ├── shop/                      # 상점 & 결제
│   ├── board/                     # 게시판 (v2)
│   ├── system/                    # 시스템 (공지, 설정)
│   └── admin/                     # 관리자 시스템
│
└── shared/                        # 공통 컴포넌트/훅
```

**핵심 원칙:** 기능별 폴더 완전 독립 → 담당자별 작업 영역 겹치지 않음

### 작업 영역별 담당 파일 (현재)

| 작업 영역 | 수정 파일 | 충돌 가능성 |
|---------|---------|-----------|
| **캐릭터 이동/애니메이션** | `components/character/Character.jsx` | **낮음** (독립 파일) |
| **카메라 시스템** | `components/camera/CameraController.jsx` | **낮음** (독립 파일) |
| **맵/환경 추가** | `components/map/Level1.jsx`, `Level1Map.jsx` | **낮음** (독립 파일) |
| **UI 모달 수정** | `components/BoardModal.js`, `MenuModal.js` 등 | **낮음** (각 모달별 파일) |
| **게임 로직/상태** | `App.js` | **중간** (메인 파일) |

### 향후 작업 영역 (요구사항 기반)

| 기능 영역 | 담당 폴더 | 충돌 가능성 | 설명 |
|----------|---------|------------|------|
| **회원 시스템** | `features/auth/` | ✅ **0%** | 로그인/회원가입 완전 독립 |
| **프로필** | `features/profile/` | ✅ **0%** | 프로필 조회/수정/이미지 |
| **3D 캐릭터** | `features/world/character/` | ✅ **0%** | 이동, 애니메이션, 물리 |
| **3D 맵/환경** | `features/world/maps/` | ✅ **0%** | 광장, 로컬 방 맵 |
| **GPS 로컬 방** | `features/localRoom/` | ✅ **0%** | 방 생성/관리 |
| **실시간 채팅** | `features/social/chat/` | ✅ **0%** | 채팅 UI + WebSocket |
| **친구 시스템** | `features/social/friends/` | ✅ **0%** | 친구 추가/목록 |
| **접속자 목록** | `features/social/userList/` | ✅ **0%** | Tab 키 모달 |
| **미니게임** | `features/minigame/` | ✅ **0%** | 로비, 게임별 폴더 |
| **커스터마이징** | `features/customization/` | ✅ **0%** | 외형, 의상 변경 |
| **상점/결제** | `features/shop/` | ✅ **0%** | 아이템 구매, 인벤토리 |
| **게시판** | `features/board/` | ✅ **0%** | 게시글, 댓글 |
| **공지사항** | `features/system/notice/` | ✅ **0%** | 공지 팝업 |
| **설정** | `features/system/settings/` | ✅ **0%** | 그래픽, 사운드, 계정 |
| **관리자 페이지** | `features/admin/` | ✅ **0%** | 완전 별도 페이지 |
| **API 서비스** | 각 `features/*/services/` | ✅ **0%** | UI와 분리 |
| **공통 컴포넌트** | `shared/components/` | ⚠️ **10%** | Button, Modal 등 |
| **App.jsx (라우팅)** | `App.jsx` | ⚠️ **30%** | 라우트 추가 시만 |

**핵심:** 각 팀원이 다른 `features/` 폴더에서 작업 → **충돌 확률 0%**

### 충돌 방지 규칙

#### 1. 작업 전 항상 Pull
```bash
git pull origin dev
```

#### 2. 기능별로 다른 파일 수정
**현재 구조:**
- **캐릭터 담당**: `Character.jsx`만 수정
- **맵 담당**: `Level1.jsx`, `Level1Map.jsx`만 수정
- **UI 담당**: 각 모달 파일만 수정

**향후 구조 (권장):**
- **회원 담당**: `features/auth/` 폴더만
- **채팅 담당**: `features/social/chat/` 폴더만
- **미니게임 담당**: `features/minigame/` 폴더만
- **관리자 담당**: `features/admin/` 폴더만

→ 각자 완전히 다른 폴더에서 작업하므로 **충돌 불가능**

#### 3. App.js/App.jsx 수정 시 사전 조율
`App.js`는 여러 컴포넌트를 연결하는 메인 파일이므로, 수정 전 팀원과 조율 필요:
- "지금부터 30분간 App.js 수정합니다" 선언
- 다른 팀원은 해당 시간에 App.js 건드리지 않기
- 향후 구조에서는 라우팅만 담당하므로 충돌 위험 감소

#### 4. 작은 단위로 자주 커밋/푸시
```bash
# 한 기능 완료 시 즉시 커밋
git add .
git commit -m "feat: 캐릭터 점프 애니메이션 추가"
git push origin dev
```

#### 5. 충돌 발생 시 해결 방법

##### 상황 1: 다른 사람이 같은 파일을 수정했을 때
```bash
# Pull 시 충돌 발생
git pull origin dev
# CONFLICT 메시지 표시

# 1. 충돌 파일 확인
git status

# 2. 파일 열어서 충돌 부분 확인
# <<<<<<< HEAD
# 내 코드
# =======
# 원격 저장소 코드
# >>>>>>> origin/dev

# 3. 충돌 부분 수동 수정 후 저장

# 4. 수정 완료 후 add & commit
git add .
git commit -m "Merge conflict resolved"
git push origin dev
```

##### 상황 2: 원격 저장소 코드로 완전히 덮어쓰고 싶을 때
```bash
# 내 로컬 변경사항 완전히 버리고 원격 저장소 코드로 덮어쓰기
git reset --hard origin/dev
```

##### 상황 3: 내 코드를 백업하고 원격 저장소 코드 받기
```bash
# 1. 내 변경사항 임시 저장
git stash

# 2. 원격 저장소 최신 코드 받기
git pull origin dev

# 3. 임시 저장한 내 변경사항 다시 적용
git stash pop

# 4. 충돌 발생 시 수동 해결
```

#### 6. IDE 충돌 해결 도구 활용
- **VS Code**: Source Control 패널에서 "Accept Current Change" / "Accept Incoming Change" 버튼 사용
- **IntelliJ IDEA**: VCS → Git → Resolve Conflicts 메뉴 사용

### 추가 팁

1. **브랜치 전략 활용**
   ```bash
   # 개인 작업용 브랜치 생성
   git checkout -b feature/character-jump

   # 작업 완료 후 dev에 병합
   git checkout dev
   git merge feature/character-jump
   ```

2. **작업 전 항상 상태 확인**
   ```bash
   git status  # 현재 변경사항 확인
   git log --oneline -5  # 최근 커밋 5개 확인
   ```

3. **충돌이 걱정될 땐 먼저 물어보기**
   - 팀 채팅방에 "지금 XXX 파일 수정 중이신 분 계신가요?" 확인

---

## 📋 구현된 기능 확인하기

### 1. 로그인/회원가입
1. 프론트엔드 실행 후 첫 화면에서 "Click to Start" 클릭
2. **회원가입**:
   - 닉네임, 이메일, 비밀번호 입력
   - 회원가입 완료 메시지 확인
   - 초기 화면으로 돌아감 (자동 로그인 없음)
3. **로그인**:
   - 이메일, 비밀번호 입력
   - 로그인 성공 시 3D 환경 진입

### 2. 캐릭터 이동
- **이동**: `W` `A` `S` `D` 또는 방향키
- **달리기**: `Shift` + 이동키
- **카메라 위치 로그**: `C` 키 (개발자 콘솔 확인)

### 3. 게시판 (로그인 후 사용 가능)
1. 우측 상단 **게시판 아이콘 (📋)** 클릭
2. **사이드바**:
   - 게시판 / 공지사항 전환
   - 햄버거 메뉴로 사이드바 숨김/표시
3. **글쓰기**:
   - 게시판 목록에서 "글쓰기" 버튼
   - 제목, 내용, 이미지 URL(선택) 입력
   - 작성 완료 클릭
4. **게시글 보기**:
   - 게시글 클릭 → 상세 페이지
   - 추천/비추천 버튼
   - 댓글 작성 (프론트엔드만 구현, 백엔드 연동 필요)

### 4. ESC 메뉴
- **ESC 키** 누르기 → 메뉴 모달 표시
- **계속하기**: 게임 복귀
- **설정**: 준비 중
- **로그아웃**: 로그아웃 후 초기 화면

### 5. 맵 전환
- 우측 상단 **"Open Map"** 버튼 → Mapbox 3D 지도 표시
- 좌측 상단 **"Back"** 버튼 → 기본 3D 환경 복귀

---

## 🎮 모달 사용 시 주의사항

**모달이 열려있을 때 캐릭터 이동이 자동으로 비활성화됩니다:**
- 게시판 모달
- ESC 메뉴 모달
- 로그인/회원가입 모달

모달을 닫으면 이동 기능이 다시 활성화됩니다.

---

## 🗄️ 데이터베이스 (Supabase)

### 연결 정보
- **데이터베이스**: PostgreSQL (Supabase)
- **설정 파일**: `backend/src/main/resources/application.yml`
- **현재 플랜**: Free (무료)

### 주요 테이블
- `auth.users` - 사용자 계정 (Supabase Auth)
- `public.profiles` - 사용자 프로필
- `public.boards` - 게시판
- `public.posts` - 게시글
- `public.comments` - 댓글

### 현재 데이터 현황
- **사용자**: 8명 등록
- **게시판**: 1개 (자유게시판)
- **게시글**: 0개

---

## 🛠️ 개발 환경

### 프론트엔드
- **프레임워크**: React 19.1.1
- **3D 엔진**: Three.js 0.179.1
  - React Three Fiber 9.3.0
  - React Three Drei 10.7.4
  - React Three Rapier 2.2.0 (물리 엔진)
- **HTTP 클라이언트**: Axios
- **아이콘**: React Icons

### 백엔드
- **프레임워크**: Spring Boot 3.2.0
- **언어**: Java 21
- **빌드 도구**: Gradle
- **데이터베이스**: PostgreSQL (Supabase)
- **인증**: JWT (JSON Web Token)
- **주요 라이브러리**:
  - Spring Data JPA
  - Spring Security
  - Lombok

---

## 📁 프로젝트 구조

```
3DCommunity/
├── src/                          # 프론트엔드 소스
│   ├── components/              # React 컴포넌트
│   │   ├── AuthModal.js        # 로그인/회원가입
│   │   ├── BoardModal.js       # 게시판 메인
│   │   ├── BoardList.js        # 게시글 목록
│   │   ├── BoardDetail.js      # 게시글 상세
│   │   ├── PostForm.js         # 글쓰기 폼
│   │   ├── MenuModal.js        # ESC 메뉴
│   │   ├── LandingPage.js      # 초기 화면
│   │   └── Mapbox3D.js         # 지도 컴포넌트
│   ├── services/                # API 서비스
│   │   ├── authService.js      # 인증 API
│   │   └── boardService.js     # 게시판 API
│   ├── App.js                   # 메인 앱 (3D 씬)
│   └── useKeyboardControls.js   # 키보드 입력 훅
├── backend/                     # 백엔드 소스
│   └── src/main/java/com/community/
│       ├── controller/          # REST API 컨트롤러
│       ├── service/             # 비즈니스 로직
│       ├── repository/          # JPA 레포지토리
│       ├── model/               # 엔티티 (User, Board, Post 등)
│       ├── dto/                 # 데이터 전송 객체
│       └── security/            # JWT 인증/보안
├── public/resources/            # 3D 모델 & 사운드
│   ├── Ultimate Animated Character Pack/
│   ├── GameView/PublicSquare.glb
│   └── Sounds/
└── README.md                    # 프로젝트 개요 (한글)
```

---

## 🔑 환경 변수 설정

### 프론트엔드 (.env)
```env
REACT_APP_API_URL=http://localhost:8080
REACT_APP_MAPBOX_TOKEN=your_mapbox_token_here
```

### 백엔드 (application.yml)
이미 설정되어 있음:
- Supabase PostgreSQL 연결
- JWT Secret Key
- CORS 설정

---

## 🐛 문제 해결

### 프론트엔드가 실행되지 않을 때
```bash
# node_modules 재설치
rm -rf node_modules package-lock.json
npm install --legacy-peer-deps
npm start
```

### 백엔드 연결 오류
1. Spring Boot 서버가 실행 중인지 확인 (`localhost:8080`)
2. Supabase 데이터베이스 연결 확인
3. `application.yml`의 DB 비밀번호 확인

### 게시판에 데이터가 안 보일 때
- 현재 게시글이 0개입니다
- 로그인 후 직접 글을 작성하거나
- 백엔드에서 테스트 데이터 추가 필요

---

## 📞 문의

- **GitHub**: https://github.com/kimkichan1225/3DCommunity
- **브랜치**: `backend-new` (개발 중)
- **메인 브랜치**: `main`

---

**마지막 업데이트**: 2025-11-26
